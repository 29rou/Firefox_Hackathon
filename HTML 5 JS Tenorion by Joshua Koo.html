<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>HTML 5 JS Tenorion by Joshua Koo</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
<meta name="description" content="Music with Shapes, Lights, Smokes and Colors. Click or Drag to play!"/>
<style type="text/css" media="screen">body{background-color:#333;font:14px Helvetica,Arial;color:#fff}#jcontainer{margin-top:50px;margin-left:auto;margin-right:auto;width:550px;background-color:#000;border:solid 2px #fff;-moz-border-radius:15px;-webkit-border-radius:15px;-khtml-border-radius:15px;border-radius:15px;padding:5px;text-align:center}#jtenorion{}a{color:#fff}#jdebug{}</style>
<!--<script src="../jquery-1.3.2.min.js"></script>-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<!--[if IE]><script src="../notation/excanvas.js"></script><![endif]-->
<script src="http://jabtunes.com/labs/swfobject.js.pagespeed.jm.1RrDOSyVY3.js" type="text/javascript"></script>
<script type="text/javascript">var flapLength=16;var padding=6;var fps=15;var jtenorionWidth=450;var color=true;var rounded=true;var smoke=true;var palette=false;var pitchOffset=0;var browserwidth;var browserheight;var canvas;var ctx;var animation;var outBounds;var clicked={pressed:false,out:false};var oldd=new Date();var flaps;var gridwidth;var elements=[];var padswitches=[];var waves=[];var interval=Math.round(1000/fps);function init(){canvas=document.getElementById('jtenorion');canvas.width=canvas.style.width=jtenorionWidth;canvas.height=canvas.style.height=jtenorionWidth;canvas.onselectstart=function(){return false;}
if(!canvas.getContext){alert("Sorry, your browser does not support html 5 canvas. Please try with another browser!!");return;}
ctx=canvas.getContext("2d");var h=canvas.height;gridwidth=(h-(flapLength+1)*padding)/flapLength;var tx=0,ty=0,z=0;for(var i1=0;i1<flapLength;i1++){tx=padding;ty+=padding;for(var i2=0;i2<flapLength;i2++){elements.push({x:Math.round(tx),y:Math.round(ty),gx:i2,gy:i1,o:z});tx+=gridwidth+padding;z++;}
ty+=gridwidth;}
paintGrids();for(var i=0;i<flapLength*flapLength;i++){padswitches[i]=false;}}
var row=0;function paintRow(){row++;row%=16;paintRow2(row);return false;}
var strokeButtonBorder="rgba(90,90,90,1)";var fillClickedButton="rgba(120,120,120,0.8)";var fillUnclickedButton="rgba(40,40,40,0.5)";var fillBackground="rgba(0,0,0,1)";var fillHighlightColor="rgba(256,256,256,1)"
function paintRow2(row){ctx.globalCompositeOperation="source-over";var i,te;for(i=row;row<elements.length;i+=16){te=elements[i];if(padswitches[te.o]){ctx.fillStyle=fillHighlightColor;if(rounded){roundedRect(ctx,te.x,te.y,gridwidth,gridwidth,5);ctx.fill();}else{ctx.fillRect(te.x,te.y,gridwidth,gridwidth);}
if(smoke){waves.push({g:te.o,t:0});}}}}
function roundedRect(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);}
function paintOneGrid(e){var te;te=elements[e];ctx.globalCompositeOperation="source-over";ctx.strokeStyle=strokeButtonBorder;if(rounded){roundedRect(ctx,te.x,te.y,gridwidth,gridwidth,5);ctx.stroke();}else{ctx.strokeRect(te.x,te.y,gridwidth,gridwidth);}
if(padswitches[te.o]){ctx.fillStyle=fillClickedButton;if(rounded){roundedRect(ctx,te.x,te.y,gridwidth,gridwidth,5);ctx.fill();}else{ctx.fillRect(te.x,te.y,gridwidth,gridwidth);}}else{ctx.fillStyle=fillUnclickedButton;if(rounded){roundedRect(ctx,te.x,te.y,gridwidth,gridwidth,5);ctx.fill();}else{ctx.fillRect(te.x,te.y,gridwidth,gridwidth);}}}
function paintGrids(){ctx.globalCompositeOperation="source-over";ctx.fillStyle=fillBackground;ctx.fillRect(0,0,canvas.width,canvas.height);for(var e in elements){paintOneGrid(e);}
if(smoke){ctx.globalCompositeOperation="lighter";var ttl=15;var p,e;for(w in waves){p=waves[w];e=elements[p.g];var r,g,b,a,l,d;d=(ttl-p.t)/ttl;l=p.t*25;var ex=e.x+gridwidth/2,ey=e.y+gridwidth/2;var gradblur=ctx.createRadialGradient(ex,ey,0,ex,ey,l);ctx.beginPath();if(color){if(palette){r=255-42.5*e.gx;g=255-42.5*e.gy;b=5*p.t;}else{r=(Math.random()*255)*d*1.8;g=(Math.random()*255)*d*1.8;b=(Math.random()*255)*d*1.8;}
r=r>>0;g=g>>0;b=b>>0;a=1;}else{r=g=b=Math.round(d*100);a=1;}
var edgecolor1="rgba("+r+","+g+","+b+",0.45)";var edgecolor2="rgba("+r+","+g+","+b+",0.3)";var edgecolor3="rgba("+r+","+g+","+b+",0.15)";var edgecolor4="rgba("+r+","+g+","+b+",0)";gradblur.addColorStop(0,edgecolor4);gradblur.addColorStop(0.15,edgecolor3);gradblur.addColorStop(0.3,edgecolor2);gradblur.addColorStop(0.5,edgecolor1);gradblur.addColorStop(0.7,edgecolor2);gradblur.addColorStop(0.85,edgecolor3);gradblur.addColorStop(1,edgecolor4);ctx.fillStyle=gradblur;ctx.arc(ex,ey,l,0,Math.PI*2,false);ctx.fill();p.t++;if(p.t>ttl){waves.splice(w,1);}}}}
function ripple(){paintGrids();return false;}
function getGrid(x,y){var te;for(var e in elements){te=elements[e];if(te.x<=x&&x<=(te.x+gridwidth)&&te.y<=y&&y<=(te.y+gridwidth)){return te;}}
return null;}
function toggleGrid(x,y){var clickgrid;if(clickgrid=getGrid(x,y)){if(clicked.lastGrid&&(clickgrid.gx==clicked.lastGrid.gx)&&(clickgrid.gy==clicked.lastGrid.gy)){}else{if(clicked.toggle==null){clicked.toggle=!padswitches[clickgrid.o];}
if(clicked.toggle!=padswitches[clickgrid.o]){if(!$('#sionProject')[0].as_toggle){$('#jdebug').html("Error, flash bridge is not loaded");}
var ret=$('#sionProject')[0].as_toggle(clickgrid.gx,clickgrid.gy);padswitches[clickgrid.o]=clicked.toggle;paintOneGrid(clickgrid.o);clicked.lastGrid=clickgrid;}}}else{clicked.lastGrid=null;}}
function clearClicks(){$('#sionProject')[0].as_clearall();padswitches=[];paintGrids();}
function toggleColor(v){color=v;}
function toggleRounded(v){rounded=v;}
function toggleSmoke(v){smoke=v;}
function toggleRandom(v){palette=!v;}
function pitchUp(){pitchOffset++;$('#sionProject')[0].as_pitch(pitchOffset);}
function pitchDown(){pitchOffset--;$('#sionProject')[0].as_pitch(pitchOffset);}
$(document).ready(function(){init();$(canvas).mousedown(function(e){var x=e.pageX-$(this).offset().left;var y=e.pageY-$(this).offset().top;clicked.pressed=true;toggleGrid(x,y);}).mouseup(function(e){clicked.pressed=false;clicked.out=false;clicked.x=0;clicked.y=0;clicked.lastGrid=null;clicked.toggle=null;}).mousemove(function(e){var x=e.pageX-$(this).offset().left;var y=e.pageY-$(this).offset().top;if(clicked.out&&!outBounds){clicked.pressed=true;clicked.out=false;}else if(clicked.pressed&&outBounds){clicked.pressed=false;clicked.out=true;}
if(clicked.pressed){toggleGrid(x,y);}else{if(getGrid(x,y)!=null){$('body').css({cursor:'pointer'});}else{$('body').css({cursor:'auto'});}}}).mouseout(function(e){if(clicked.pressed)clicked.out=true;clicked.pressed=false;}).mouseenter(function(e){if(clicked.out){clicked.pressed=true;clicked.out=false;}});});function initDim(){browserwidth=$(window).width();browserheight=$(window).height();}
function play(){if(!animation){animation=setInterval(ripple,interval);}
$('#sionProject')[0].as_play();}
function stop(){$('#sionProject')[0].as_shutup();if(animation){clearInterval(animation);animation=null;}}
var swfCallback=function(e){$('#jdebug').append(e.success?'Loading...':'Not loaded');}
function sionLoaded(t){$('#jdebug').html(t?'Loaded.':'Not loaded');$('#sionProject')[0].as_instrument('midi.chrom1');play();}
function onBeat(x){paintRow2(x);}
function onTimer(x){}
function testing(x){}
function changeInstrument(){var ins=$('#instrument').val();$('#sionProject')[0].as_instrument(ins);}
var flashvars={};var params={menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#000000"};var attributes={id:"sionProject"};swfobject.embedSWF("sionProject.swf","altContent","1%","1%","9.0.0","expressInstall.swf",flashvars,params,attributes,swfCallback);</script>
</head>
<body>
<div id="jcontainer">
<div style="text-align:center; padding:5px;">
Hi, welcome to my javascript implementation of
the Tenorion like instrument using HTML 5 Canvas and the Sion AS3 library.<br/>
<a href="http://www.lab4games.net/zz85/blog/2010/08/09/musicgeeknotes-creating-music-with-graphics-lights-and-smokes/">More information</a>
<br/>
<input type="button" onclick="play();" value="Play"/>&nbsp;
<input type="button" onclick="stop();" value="Shh..Stop!"/>&nbsp;
<input type="button" onclick="clearClicks();" value="Clear All"/>&nbsp;
<input type="button" onclick="pitchUp();" value="&uarr;"/>&nbsp;
<input type="button" onclick="pitchDown();" value="&darr;"/>&nbsp;
<br/>
<select id="instrument" onchange="changeInstrument();">
<option value="valsound.piano1">Chose Instrument!</option>
<option value="valsound.piano1">Piano</option>
<option value="valsound.bell1">Bell</option>
<option value="midi.chrom1">Chimes 1</option>
<option value="midi.chrom5">Chimes 2</option>
<option value="midi.organ1">Organ</option>
</select>&nbsp;
<input type="checkbox" onclick="toggleRounded(this.checked);" checked />Rounded&nbsp;
<input type="checkbox" onclick="toggleSmoke(this.checked);" checked />Smokes&nbsp;
<input type="checkbox" onclick="toggleColor(this.checked);" checked />Colours&nbsp;
<input type="checkbox" onclick="toggleRandom(this.checked);" checked />Random Colours&nbsp;
<a href="http://screenr.com/record" target="_blank">Record a session</a>
<!--
	<input type="button" onclick="paintRow();" value="Step column Animation" />&nbsp;
	-->
<!-- Not DONE YET.
	Clear All Tweak settings
	<a href="#" onclick="return fill();">Select Size</a>&nbsp; 
	<a href="#" onclick="return fit();">Select Speed</a>&nbsp;
	<a href=="#" onclick="return reset(1);">Save this and share</a>&nbsp;
	-->
</div>
<canvas id="jtenorion" width="500" height="500"></canvas>
<!--
<div id="testing">
	Beat:<div id="beat"></div>
	Timer:<div id="timer"></div>	
</div>
-->
<div id="jdebug"></div>
<br/>
<div id="altContent">
<h1>sionProject</h1>
<p>Alternative content</p>
<p><a href="http://www.adobe.com/go/getflashplayer"><img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" pagespeed_url_hash="3268587275"/></a></p>
</div>
<iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fjabtunes.com%2Flabs%2Fjtenorion.html&amp;layout=button_count&amp;show_faces=false&amp;width=50&amp;action=like&amp;font=arial&amp;colorscheme=dark&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:50px; height:21px;" allowTransparency="true"></iframe>
</div> <!-- end of jcontainer -->
<script type="text/javascript">var gaJsHost=(("https:"==document.location.protocol)?"https://ssl.":"http://www.");document.write(unescape("%3Cscript src='"+gaJsHost+"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script>
<script type="text/javascript">try{var pageTracker=_gat._getTracker("UA-7549263-1");pageTracker._trackPageview();}catch(err){}</script>
<script type="text/javascript">//<![CDATA[
(function(){var d=encodeURIComponent,f=window,g=document,h="documentElement",k="length",l="prototype",m="body",p="&",s="&ci=",t=",",u="?",v="Content-Type",w="Microsoft.XMLHTTP",x="Msxml2.XMLHTTP",y="POST",z="application/x-www-form-urlencoded",A="img",B="input",C="load",D="oh=",E="on",F="pagespeed_url_hash",G="url=";f.pagespeed=f.pagespeed||{};var H=f.pagespeed,I=function(a,b,c){this.c=a;this.e=b;this.d=c;this.b=this.f();this.a={}};I[l].f=function(){return{height:f.innerHeight||g[h].clientHeight||g[m].clientHeight,width:f.innerWidth||g[h].clientWidth||g[m].clientWidth}};I[l].g=function(a){a=a.getBoundingClientRect();return{top:a.top+(void 0!==f.pageYOffset?f.pageYOffset:(g[h]||g[m].parentNode||g[m]).scrollTop),left:a.left+(void 0!==f.pageXOffset?f.pageXOffset:(g[h]||g[m].parentNode||g[m]).scrollLeft)}};I[l].h=function(a){if(0>=a.offsetWidth&&0>=a.offsetHeight)return!1;a=this.g(a);var b=a.top.toString()+t+a.left.toString();if(this.a.hasOwnProperty(b))return!1;this.a[b]=!0;return a.top<=this.b.height&&a.left<=this.b.width};I[l].i=function(a){var b;if(f.XMLHttpRequest)b=new XMLHttpRequest;else if(f.ActiveXObject)try{b=new ActiveXObject(x)}catch(c){try{b=new ActiveXObject(w)}catch(e){}}if(!b)return!1;b.open(y,this.c+(-1==this.c.indexOf(u)?u:p)+G+d(this.e));b.setRequestHeader(v,z);b.send(a);return!0};I[l].k=function(){for(var a=[A,B],b=[],c={},e=0;e<a[k];++e)for(var q=g.getElementsByTagName(a[e]),n=0;n<q[k];++n){var r=q[n].getAttribute(F);r&&(q[n].getBoundingClientRect&&this.h(q[n]))&&!(r in c)&&(b.push(r),c[r]=!0)}if(0!=b[k]){a=D+this.d;a+=s+d(b[0]);for(e=1;e<b[k];++e){c=t+d(b[e]);if(131072<a[k]+c[k])break;a+=c}H.criticalImagesBeaconData=a;this.i(a)}};H.j=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent(E+b,c);else{var e=a[E+b];a[E+b]=function(){c.call(this);e&&e.call(this)}}};H.l=function(a,b,c){var e=new I(a,b,c);H.j(f,C,function(){f.setTimeout(function(){e.k()},0)})};H.criticalImagesBeaconInit=H.l;})();pagespeed.criticalImagesBeaconInit('/mod_pagespeed_beacon','http://jabtunes.com/labs/jtenorion.html','f81aupMvhr');
//]]></script></body>
</html>